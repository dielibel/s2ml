Bootstrap: docker
From: ubuntu:18.04 

%files
    src/

%post
    apt-get -y update && apt-get install -y git
    apt-get update && apt-get install -y software-properties-common gcc
    add-apt-repository -y ppa:deadsnakes/ppa
    apt-get update && apt-get install -y python3.7 python3-distutils python3-pip

    git clone https://github.com/openai/CLIP
    git clone https://github.com/dielibel/guided-diffusion
    python3 -m pip install --upgrade pip
    python3 -m pip install --upgrade Pillow
    pip install -e ./CLIP --no-cache-dir
    pip install -e ./guided-diffusion

    git clone https://github.com/CompVis/taming-transformers
    pip install ftfy regex tqdm omegaconf pytorch-lightning --no-cache-dir
    pip install kornia --no-cache-dir
    pip install einops
    pip install transformers
     
    pip install stegano
    apt install exempi -y
    pip install python-xmp-toolkit
    pip install imgtag
    pip install pillow==7.1.2
    pip install taming-transformers
                                
    git clone https://github.com/xinntao/ESRGAN

    pip install imageio-ffmpeg

    pip freeze > requirements.txt

%runscript
    echo "$*"
